#!/bin/bash
# Determine ezdpl home
if [[ -z ${EZDPL_HOME} ]]; then
    _dir=$(dirname `readlink -f $0`)
    cd $_dir && cd ..
    EZDPL_HOME=`pwd`
fi
echo "EZDPL_HOME : ${EZDPL_HOME}"

_hint="
Usage:
appa p  <host>    check all tomcat processes.
appa l  <host>    list  all tomcat apps & mounted nfs.
"

if [[ -z $1 ]];then
  echo "$_hint"
  exit 1
else
  _op=$1
fi

IFS=$'\n'
_servers=`${EZDPL_HOME}/bin/sqlezdpl "SELECT distinct srvname, port FROM v_srvweb ORDER BY srvname" | grep -v name`
for x in $_servers;do
  _host=`echo $x|awk -F'\t' '{print $1}'`
  _port=`echo $x|awk -F'\t' '{print $2}'`
  echo [ $_host:$_port ]
  ${EZDPL_HOME}/bin/app $_op $_host
  echo
done

